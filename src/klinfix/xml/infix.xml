<?xml version="1.0" encoding="UTF-8"?>
<KLISH
	xmlns="https://klish.libcode.org/klish3"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="https://src.libcode.org/pkun/klish/src/master/klish.xsd">

  <PLUGIN name="klish"/>
  <PLUGIN name="script"/>

  <PLUGIN name="sysrepo">
    ShowBrackets = y
    ShowSemicolons = y
    FirstKeyWithStatement = n
    MultiKeysWithStatement = y
    Colorize = y
    Indent = 2
  </PLUGIN>


  <PTYPE name="PLINE_SET">
    <COMPL>
      <ACTION sym="srp_compl@sysrepo"/>
    </COMPL>
    <HELP>
      <ACTION sym="srp_help@sysrepo"/>
    </HELP>
    <ACTION sym="PLINE_SET@sysrepo"/>
  </PTYPE>

  <PTYPE name="PLINE_DEL">
    <COMPL>
      <ACTION sym="srp_compl@sysrepo"/>
    </COMPL>
    <HELP>
      <ACTION sym="srp_help@sysrepo"/>
    </HELP>
    <ACTION sym="PLINE_DEL@sysrepo"/>
  </PTYPE>

  <PTYPE name="PLINE_EDIT">
    <COMPL>
      <ACTION sym="srp_compl@sysrepo"/>
    </COMPL>
    <HELP>
      <ACTION sym="srp_help@sysrepo"/>
    </HELP>
    <ACTION sym="PLINE_EDIT@sysrepo"/>
  </PTYPE>

  <PTYPE name="PLINE_INSERT_FROM">
    <COMPL>
      <ACTION sym="srp_compl@sysrepo"/>
    </COMPL>
    <HELP>
      <ACTION sym="srp_help@sysrepo"/>
    </HELP>
    <ACTION sym="PLINE_INSERT_FROM@sysrepo"/>
  </PTYPE>

  <PTYPE name="PLINE_INSERT_TO">
    <COMPL>
      <ACTION sym="srp_compl_insert_to@sysrepo"/>
    </COMPL>
    <HELP>
      <ACTION sym="srp_help_insert_to@sysrepo"/>
    </HELP>
    <ACTION sym="PLINE_INSERT_TO@sysrepo"/>
  </PTYPE>


  <VIEW name="main">
    <HOTKEY key="^D" cmd="exit"/>

    <PROMPT>
      <ACTION sym="prompt" exec_on="always">%u@%h:exec> </ACTION>
    </PROMPT>

    <COMMAND name="exit" help="Exit">
      <ACTION sym="nav">pop</ACTION>
    </COMMAND>

    <COMMAND name="configure" help="Configure system">
      <ACTION sym="nav">replace configure</ACTION>
    </COMMAND>

    <COMMAND name="show" help="Show" mode="switch">
      <COMMAND name="running-config" help="Show running-config">
	<ACTION sym="srp_show_running@sysrepo"/>
      </COMMAND>
    </COMMAND>

  </VIEW>

  <VIEW name="configure">

    <PROMPT>
      <ACTION sym="srp_prompt_edit_path@sysrepo"/>
      <ACTION sym="prompt" exec_on="always">%u@%h:configure> </ACTION>
    </PROMPT>

    <HOTKEY key="^C" cmd="up"/>
    <HOTKEY key="^D" cmd="abort"/>
    <HOTKEY key=":" cmd="show"/>
    <HOTKEY key="!" cmd="check"/>

    <!-- Move -->

    <COMMAND name="abort" help="Exit configuration mode, abandon changes">
      <ACTION sym="srp_rollback@sysrepo"/>
      <ACTION sym="nav">replace main</ACTION>
    </COMMAND>

    <COMMAND name="leave" help="Exit configuration mode, commit changes">
      <ACTION sym="srp_commit@sysrepo"/>
      <ACTION sym="nav" exec_on="success">replace main</ACTION>
    </COMMAND>

    <COMMAND name="end" help="Climb one configuration context, or leave (from top)">
      <ACTION sym="srp_up@sysrepo"/>
      <ACTION sym="srp_commit@sysrepo" exec_on="fail"/>
      <ACTION sym="nav" exec_on="success">replace main</ACTION>
    </COMMAND>

    <COMMAND name="up" help="Climb one configuration context">
      <ACTION sym="srp_up@sysrepo"/>
    </COMMAND>

    <COMMAND name="top" help="Climb to configuration root">
      <ACTION sym="srp_top@sysrepo"/>
    </COMMAND>

    <COMMAND name="goto" help="Go to configuration context">
      <PARAM name="path" ptype="/PLINE_EDIT" max="100"/>
      <ACTION sym="srp_edit@sysrepo"/>
    </COMMAND>

    <!-- Edit -->

    <COMMAND name="set" help="Set configuration setting">
      <PARAM name="path" ptype="/PLINE_SET" max="100"/>
      <ACTION sym="srp_set@sysrepo"/>
    </COMMAND>

    <COMMAND name="no" help="Delete configuration setting(s)">
      <PARAM name="path" ptype="/PLINE_DEL" max="100"/>
      <ACTION sym="srp_del@sysrepo"/>
    </COMMAND>

    <COMMAND name="commit" help="Commit data to running-config">
      <ACTION sym="srp_commit@sysrepo"/>
    </COMMAND>

    <COMMAND name="rollback" help="Rollback to running-config">
      <ACTION sym="srp_rollback@sysrepo"/>
    </COMMAND>

    <!-- Display -->

    <COMMAND name="check" help="Verify the candidate configuration">
      <ACTION sym="srp_verify@sysrepo"/>
    </COMMAND>

    <COMMAND name="show" help="Show data hierarchy">
      <PARAM name="path" ptype="/PLINE_EDIT" min="0" max="100"/>
      <ACTION sym="srp_show@sysrepo"/>
    </COMMAND>

    <COMMAND name="diff" help="Show diff to running-config">
      <PARAM name="path" ptype="/PLINE_EDIT" min="0" max="100"/>
      <ACTION sym="srp_diff@sysrepo"/>
    </COMMAND>

    <!-- Misc -->

    <COMMAND name="do" help="Execute operational mode command">
      <VIEW name="operational" ref="/main"/>
    </COMMAND>

  </VIEW>

</KLISH>
